@page "/register"
@inject IAuthService AuthService
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar

<MudContainer MaxWidth="MaxWidth.Small" Class="mt-16">
    <MudPaper Elevation="3" Class="pa-8">
        <MudText Typo="Typo.h5" Align="Align.Center" GutterBottom="true">Crear Cuenta</MudText>

        <EditForm Model="_registerRequest" OnValidSubmit="HandleRegister">
            <DataAnnotationsValidator />

            <MudTextField Label="Nombre Completo"
                          @bind-Value="_registerRequest.FullName" For="@(() => _registerRequest.FullName)"
                          Variant="Variant.Outlined" Class="mb-4" />

            <MudTextField Label="Correo Electrónico"
                          @bind-Value="_registerRequest.Email" For="@(() => _registerRequest.Email)"
                          Variant="Variant.Outlined" Class="mb-4" />

            <MudTextField Label="Contraseña"
                          @bind-Value="_registerRequest.Password" For="@(() => _registerRequest.Password)"
                          Variant="Variant.Outlined" InputType="InputType.Password" Class="mb-4" />

            <MudTextField Label="Confirmar Contraseña"
                          @bind-Value="_registerRequest.ConfirmPassword" For="@(() => _registerRequest.ConfirmPassword)"
                          Variant="Variant.Outlined" InputType="InputType.Password" Class="mb-6" />

            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" Class="mb-4">
                Registrarse
            </MudButton>
        </EditForm>

        <MudText Align="Align.Center">
            ¿Ya tienes cuenta? <MudLink Href="login">Inicia Sesión</MudLink>
        </MudText>

    </MudPaper>
</MudContainer>

@code {
    private RegisterRequest _registerRequest = new RegisterRequest();

    private async Task HandleRegister()
    {
        var result = await AuthService.Register(_registerRequest);
        if (result != null)
        {
            Snackbar.Add("Registro exitoso", Severity.Success);
            NavigationManager.NavigateTo("");
        }
        else
        {
            Snackbar.Add("Error al registrar. El correo podría estar en uso.", Severity.Error);
        }
    }
}
